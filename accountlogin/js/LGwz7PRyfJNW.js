import{_ as t,bd as e,B as n,b3 as o,b4 as i,be as s,K as a,bf as r,b0 as c,f as u,bg as l,g as d,b5 as m,b6 as b,bb as f,bh as h,ba as g,a_ as p,bc as v,H as w,J as A,a5 as y,a6 as _,a$ as I}from"./chunk.common_81888316.esm.js";function C(){return t(this,void 0,void 0,(function*(){try{if(e(window.location.pathname).endsWith("/account"))return void function(){const t=s("analytics_trace_id");if(t){new o({elementName:"shop-login-button",flowVersion:i.SignIn,analyticsTraceId:t}).trackClassicCustomerAccountsAccountPageImpression()}const e=a(r);if(e){const t=JSON.parse(decodeURIComponent(JSON.parse(`"${e.replace(/"/g,'\\"')}"`))),n=null==t?void 0:t.analytics_trace_id,s=null==t?void 0:t.email;if(!n)throw new S("Missing analytics trace ID in Sign in with Shop cookie");if(!c(s))throw new S("Tried to show Login with Shop on customer account page with an invalid email",n);const a=document.createElement("shop-login-button");a.setAttribute("client-id",""),a.setAttribute("action","default"),a.setAttribute("version","2"),a.setAttribute("flow-version",i.SignIn),a.setAttribute("analytics-context",u.ClassicCustomerAccounts),a.setAttribute("analytics-trace-id",n),a.setAttribute("hide-button","true"),a.setAttribute("email-verification-required","true"),document.body.appendChild(a),a.requestShow(s),l(r,"/account");new o({elementName:"shop-login-button",analyticsTraceId:n,flowVersion:i.SignIn}).trackClassicCustomerAccountsAccountPageImpression()}}();!function(){const t=d(),e=new o({elementName:"shop-login-button",flowVersion:i.SignIn,analyticsTraceId:t}),s=new WeakMap;let a=null;const r=m({onVisible:w,onFallback:t=>{t.addEventListener("focus",c,{once:!0}),e.trackShopPayLoginWithSdkErrorEvents({apiKey:"",errorCode:"fallback_to_focus_event",errorMessage:"Fallback to focus event for classic customer accounts"})}});function c(t){w(t.target)}function l(t,e){var n,o;const i=null===(n=t.elements.namedItem("checkout_url"))||void 0===n?void 0:n.value,s=null===(o=t.elements.namedItem("return_url"))||void 0===o?void 0:o.value,a=new URLSearchParams(Object.assign(Object.assign({analytics_trace_id:e},i&&{checkout_url:i}),s&&{return_url:s}));return`${window.location.origin}/account/redirect?${a.toString()}`}function w(o){var r;const c=o.form;if(!c)return void n.notify(new Error("Email form missing for classic customer accounts"));s.has(o)&&(n.notify(new Error("Input listener already exists for input")),null===(r=s.get(o))||void 0===r||r.destroy(),s.delete(o));const d=document.createElement("input");d.type="hidden",d.name="login_with_shop[analytics_trace_id]",d.value=t,c.appendChild(d),a||(a=function(t){let e,n=!1;e=document.querySelector("shop-login-button:not([action])"),e||(e=document.createElement("shop-login-button"),e.setAttribute("hide-button","true"),n=!0);e.setAttribute("client-id",""),e.setAttribute("action","default"),e.setAttribute("version","2"),e.setAttribute("flow-version",i.SignIn),e.setAttribute("analytics-context",u.ClassicCustomerAccounts),e.setAttribute("analytics-trace-id",t),e.setAttribute("email-verification-required","true"),e.setAttribute("disable-sign-up","true"),e.setAttribute("auto-open","true"),e.setAttribute("consent-challenge",""),Object.entries(p()).forEach((([t,n])=>{e.setAttribute(t,n)})),n&&document.body.appendChild(e);return e}(t),e.trackClassicCustomerAccountsLoginPageImpression(),a.addEventListener("completed",(()=>{const e=l(c,t);window.location.assign(e)})),a.addEventListener("modalclosed",(()=>{h(v,"true")}))),a.email=o.value,s.set(o,new g(o,(t=>{a.email=t})))}b({selector:f,onElementFound:t=>r.observe(t)})}()}catch(t){if(t instanceof Error&&n.notify(t),t instanceof S){new o({elementName:"shop-login-button",flowVersion:i.SignIn,analyticsTraceId:t.analyticsTraceId}).trackShopPayLoginWithSdkErrorEvents({apiKey:"",errorCode:t.code,errorMessage:t.message})}}}))}class S extends Error{constructor(t,e=d()){super(t),this.analyticsTraceId=e,this.name="InitCustomerAccountsError",this.code="init_customer_accounts_error"}}w()&&(A({bundle:"initCustomerAccounts",bundleLocale:"en"}),y(),_(),I("initCustomerAccounts",C));
//# sourceMappingURL=client.init-customer-accounts_129eb130.en.esm.js.map
